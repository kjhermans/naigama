#!/usr/bin/perl

use Data::Dumper;

print STDERR "This is Naigama decompiler Generation 3.\n";

my ($inputfile, $outputfile) = ( '-', '-' );

while (my $arg = shift @ARGV) {
  if ($arg =~ s/^-//) {
    while ($arg =~ s/^(.)//) {
      my $option = $1;
      if ($option eq 'i') {
        $inputfile = shift @ARGV;
      } elsif ($option eq 'o') {
        $outputfile = shift @ARGV;
      } else {
        die "Unknown command line option '-$option'";
      }
    }
  } else {
    $inputfile = $arg || '-';
    $outputfile = shift @ARGV || '-';
    last;
  }
}

my ($in, $out);

if ($inputfile eq '-') {
  $in = *STDIN;
} else {
  open $in, '<', $inputfile || die "Could not open $inputfile";
}

if ($outputfile eq '-') {
  $out = *STDOUT;
} else {
  open $out, '>', $outputfile || die "Could not open $outputfile";
}

my @input;
{
  while (my $line = <$in>) {
    push @input, $line;
  }
  close $in;
}

print $out "-- Generated by the gen3 decompiler.\n";
decompile(\@input);

exit 0;

##---- functions -----------------------------------------------------------##

sub decompile
{
  my $asm = shift;
  for (my $i=0; $i < scalar(@{$asm}); $i++) {
    
  }
}

1;
